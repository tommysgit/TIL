# 트랜잭션

### 트랜잭션이란?

데이터베이스의 논리적인 작업을 처리하는 단위로 단일 쿼리나 여러 개의 쿼리를 논리적인 순서에 맞게 트랜잭션으로 묶은 것을 예로들 수 있다. 트랜잭션이 제대로 처리되지 않으면 데이터 정합성을 보장할 수 없게된다.

### 특성

ACID라고 불리며, 데이터 정합성과 무결성, 일관성 등을 보장하기 위해 지켜져야하는 트랜잭션의 4가지 특성이다.

- 원자성 (Atomicity)
    - 트랜잭션의 작업은 모두 실행이 되거나 하나라도 실패하면 모두 롤백 해야하는 방식을 의미한다.
- 일관성 (Consistency)
    - 트랜잭션의 작업이 완료되면 데이터베이스는 일관적인 상태를 유지해야 한다.
- 격리성 (Isolation)
    - 서로 다른 트랜잭션 간에 영향을 끼치거나 받아서는 안된다.
- 지속성 (Durability)
    - 커밋된 트랜잭션의 결과는 데이터베이스에 영구적으로 반영돼야 한다.

### 격리수준

데이터베이스에 동시에 접근하는 트랜잭션에 대하여 동시성과 데이터 정합성을 고려하여 격리 수준을 나눈 것이다. 동시성과 데이터 정합성은 반비례 관계를 가지고있다.

- Read Uncommitted : 아직 커밋하지 않은 변경된 데이터를 다른 트랜잭션에서 읽을 수 있다.
    - 발생가능 문제 : Dirty Read, Non-Repeatable Read, Phantom Read
- Read Committed : 조회시점에 커밋된 데이터만 읽는다.
    - 발생가능 문제 : Non-Repeatable Read, Phantom Read
- Repeatable Read : 트랜잭션 범위 내에서 조회한 데이터의 내용이 일치하도록 보장한다.
    - 발생가능 문제 : Phantom Read
- Serializable : 한 트랜잭션에서 제어중인 데이터에 대하여 다른 트랜잭션이 접근하지 못하도록 한다.

### 격리수준 문제

- Dirty Read : 커밋되지 않은 변경된 데이터를 읽었는데 해당 데이터가 롤백 되어 잘못된 데이터를 읽게 된 경우
- Non-Repeatable Read : 다른 트랜잭션의 커밋 결과에 따라 트랜잭션 내에서 같은 데이터의 조회결과가 다르게 된 경우
- Phantom Read : 다른 트랜잭션의 데이터 삭제 혹은 생성에 의해 트랜잭션의 조회 결과에 행이 추가 또는 삭제된 경우