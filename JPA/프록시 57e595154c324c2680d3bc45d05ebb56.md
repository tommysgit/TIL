# 프록시

### 프록시란?

프록시는 네트워크에서도 등장하는 다양한 범위에 나오는 용어로 프록시 그 자체는 ‘대리'라는 뜻을 가지고 있다. JPA에서는 엔티티에 연관된 객체가 지연로딩일 시에 해당 엔티티를 참조하는 프록시 객체를 둔다. 

### 특징

- 엔티티를 상속받은 객체이므로 타입 체크 시에 주의해야한다.
- 객체를 처음 사용할 때 한번만 초기화된다.
- 초기화가 되면 프록시 객체가 엔티티로 바뀌는 것이 아닌 실제 엔티티에 접근할 수 있다.
- 영속성 컨텍스트와 밀접한 영관이 있다.
    - 영속성 컨텍스트에 찾는 객체가 있다면 em.getReference()를 호출하여도 실제 엔티티 반환
    - 초기화에 영속성 컨텍스트의 도움을 받아야하는데 준영속 상태의 프록시를 초기화 할때 문제가 발생한다.
    

### 즉시로딩 지연로딩

- 즉시로딩 (EAGER LOADING) : 엔티티를 조회할 때 연관된 엔티티도 같이 조회하는 것
    - 대부분의 JPA 구현체들은 최적화를 위해 조인 쿼리를 이용한다.
    - 연관된 엔티티와의 관계가 선택적이라면 외부조인을 필수적 관계라면 내부조인을 이용한다.
- 지연로딩 (LAZY LOADING) : 엔티티와 연관된 객체를 실제 사용할 때 조회하는 것
    - 연관된 엔티티를 프록시 객체로 두고 실제 조회가 일어날 때 프록시를 초기화하여 데이터베이스를 조회한다.

### 영속성 전이

엔티티와 연관된 엔티티도 같이 영속 상태로 만들고 싶을 때 영속성 전이 기능을 사용할 수 있다. JPA CASCADE옵션을 통하여 영속성 전이를 사용할 수 있다. JPA에서 엔티티를 저장할 때 연관된 모든 엔티티는 영속 상태이어야 하니 주의해서 사용해야한다.
CASECADE의 종류에는 ALL, PERSIST, MERGE, REMOVE등이 있고 OneToMany에서 One에 해당하는 엔티티에서 설정할 수 있다. 데이터베이스의 외래키 CASECADE와 비슷하다고 볼 수 있다.

### Reference

[자바 ORM 표준 JPA 프로그래밍 - 교보문고](http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&mallGb=KOR&barcode=9788960777330&orderClick=LEa&Kc=)